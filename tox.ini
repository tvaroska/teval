[tox]
# Define the test environments - matrix of Python versions (3.10-3.13) Ã— Pydantic versions (lowest + latest)
env_list =
    py{310,311,312,313}-pydantic{lowest,latest}
# Require the tox-uv plugin
requires = tox-uv
# Isolate the build
isolated_build = True

[testenv]
# Use the tox-uv runner for faster virtualenv creation
runner = uv-venv-runner
# Use uv's managed Python versions instead of system Python
uv_python_preference = managed
description = Run unit tests with pytest
# Install test dependencies with different Pydantic versions
deps =
    pytest>=8.0.0
    pytest-cov>=7.0.0
    pydanticlowest: pydantic==2.9.0
    pydanticlatest: pydantic>=2.9.0,<3.0.0
# Pass Google Cloud credentials if present (for future integration tests)
pass_env =
    GOOGLE_CLOUD_PROJECT
    GOOGLE_APPLICATION_CREDENTIALS
commands =
    pytest tests/test_metrics.py -v

# Convenience environment to run all tests with coverage on Python 3.12 with latest Pydantic
[testenv:coverage]
basepython = python3.12
deps =
    pytest>=8.0.0
    pytest-cov>=7.0.0
    pydantic>=2.9.0,<3.0.0
commands =
    pytest --cov=teval --cov-report=term-missing --cov-report=html -v

# Run tests across all Python versions with latest Pydantic only (faster CI)
[testenv:py{310,311,312,313}]
deps =
    pytest>=8.0.0
    pydantic>=2.9.0,<3.0.0
commands =
    pytest tests/test_metrics.py -v
